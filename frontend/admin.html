<!doctype html>
<html lang="fa" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WarOps Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    * {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .glass-morphism {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .animated-gradient {
      background: linear-gradient(45deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #667eea 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .btn-primary {
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
    }
    
    .loading-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(139, 92, 246, 0.3);
      border-top-color: #8b5cf6;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .status-online {
      background: #10b981;
      box-shadow: 0 0 10px #10b981;
    }
    
    .status-offline {
      background: #ef4444;
      box-shadow: 0 0 10px #ef4444;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-screen overflow-auto">
  <div class="animated-gradient fixed inset-0"></div>
  <div id="app" class="relative z-10 min-h-screen"></div>
  <div id="notification" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 500px;"></div><!-- Modal Login -->
  <div id="loginModal" class="modal active">
   <div class="glass-morphism rounded-3xl p-8 max-w-md w-full mx-4">
    <div class="text-center mb-8">
     <div class="w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-4" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
      <svg width="40" height="40" viewbox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
     </div>
     <h2 class="text-3xl font-black text-white mb-2">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
     <p class="text-white/70">WarOps Admin Panel</p>
    </div>
    <form id="loginForm" class="space-y-6">
     <div><label class="block font-semibold mb-3 text-white">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label> <input type="text" id="loginUsername" required class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="admin">
     </div>
     <div><label class="block font-semibold mb-3 text-white">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label> <input type="password" id="loginPassword" required class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
     </div><button type="submit" class="btn-primary w-full py-4 rounded-2xl font-bold text-white" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);"> ğŸ” ÙˆØ±ÙˆØ¯ </button>
    </form>
    <div class="mt-6 text-center"><a href="/index.html" class="text-white/70 hover:text-white text-sm">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù¾Ù†Ù„ Ù†ØµØ¨</a>
    </div>
   </div>
  </div><!-- Modal Add Server -->
  <div id="addServerModal" class="modal">
   <div class="glass-morphism rounded-3xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
     <h3 class="text-2xl font-bold text-white">â• Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÙˆØ± Ø¬Ø¯ÛŒØ¯</h3><button onclick="closeModal('addServerModal')" class="w-10 h-10 rounded-xl bg-white/10 text-white hover:bg-white/20">âœ•</button>
    </div>
    <form id="addServerForm" class="space-y-6">
     <div><label class="block font-semibold mb-3 text-white">Ù†Ø§Ù… Ø³Ø±ÙˆØ± *</label> <input type="text" id="serverName" required class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Production Server">
     </div>
     <div class="grid md:grid-cols-2 gap-6">
      <div><label class="block font-semibold mb-3 text-white">Ø¢ÛŒâ€ŒÙ¾ÛŒ *</label> <input type="text" id="serverIpAdd" required class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="192.168.1.100">
      </div>
      <div><label class="block font-semibold mb-3 text-white">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ *</label> <input type="text" id="serverUsernameAdd" required class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="root">
      </div>
     </div>
     <div><label class="block font-semibold mb-3 text-white">Ø±ÙˆØ´ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</label> <select id="serverAuthMethod" onchange="toggleAuthFields()" class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500"> <option value="password">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</option> <option value="key">Ú©Ù„ÛŒØ¯ SSH</option> </select>
     </div>
     <div id="passwordField"><label class="block font-semibold mb-3 text-white">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± *</label> <input type="password" id="serverPasswordAdd" class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
     </div>
     <div id="sshKeyField" style="display: none;"><label class="block font-semibold mb-3 text-white">Ú©Ù„ÛŒØ¯ SSH *</label> <textarea id="serverSshKeyAdd" rows="5" class="glass-morphism w-full px-6 py-4 rounded-2xl font-mono text-sm text-white focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="-----BEGIN RSA PRIVATE KEY-----"></textarea>
     </div>
     <div class="flex gap-4"><button type="button" onclick="closeModal('addServerModal')" class="btn-primary px-8 py-4 rounded-2xl font-bold text-white bg-white/10"> Ø§Ù†ØµØ±Ø§Ù </button> <button type="submit" class="btn-primary flex-1 py-4 rounded-2xl font-bold text-white" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);"> ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø³Ø±ÙˆØ± </button>
     </div>
    </form>
   </div>
  </div>
  <script>
    const API_URL = window.location.origin + '/api';
    let authToken = localStorage.getItem('warops_token');
    let currentUser = localStorage.getItem('warops_user');
    let currentView = 'dashboard';
    let servers = [];
    let installations = [];
    let stats = { totalServers: 0, onlineServers: 0, totalInstalls: 0, successRate: 0 };

    async function init() {
      if (!authToken) {
        showLoginModal();
        return;
      }
      
      hideLoginModal();
      await loadDashboard();
      render();
    }

    function showLoginModal() {
      document.getElementById('loginModal').classList.add('active');
    }

    function hideLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
    }

    async function handleLogin(e) {
      e.preventDefault();
      
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (response.ok && data.token) {
          authToken = data.token;
          currentUser = data.username;
          localStorage.setItem('warops_token', authToken);
          localStorage.setItem('warops_user', currentUser);
          
          hideLoginModal();
          await loadDashboard();
          render();
          
          showNotification('âœ“ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!', 'success');
        } else {
          showNotification('âœ— Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
        }
      } catch (error) {
        showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    async function loadDashboard() {
      try {
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§
        const serversResponse = await fetch(`${API_URL}/servers`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        servers = await serversResponse.json();
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†ØµØ¨â€ŒÙ‡Ø§
        const installsResponse = await fetch(`${API_URL}/installations`, {
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        installations = await installsResponse.json();
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
        stats.totalServers = servers.length;
        stats.onlineServers = servers.filter(s => s.status === 'online').length;
        stats.totalInstalls = installations.length;
        stats.successRate = installations.length > 0 
          ? Math.round((installations.filter(i => i.status === 'completed').length / installations.length) * 100)
          : 0;
        
      } catch (error) {
        showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª', 'error');
      }
    }

    function render() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <div class="p-6 md:p-10">
          <div class="max-w-7xl mx-auto">
            ${renderHeader()}
            ${renderNavigation()}
            ${renderContent()}
          </div>
        </div>
      `;
      
      attachEventListeners();
    }

    function renderHeader() {
      return `
        <header class="glass-morphism rounded-3xl p-6 mb-8">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="w-16 h-16 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
              </div>
              <div>
                <h1 class="text-3xl font-black text-white">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª WarOps</h1>
                <p class="text-white/70">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ${currentUser}</p>
              </div>
            </div>
            
            <div class="flex items-center gap-4">
              <a href="/index.html" target="_blank" class="btn-primary px-6 py-3 rounded-2xl font-bold text-white bg-white/10 hover:bg-white/20">
                ğŸš€ Ù¾Ù†Ù„ Ù†ØµØ¨
              </a>
              <button onclick="logout()" class="btn-primary px-6 py-3 rounded-2xl font-bold text-white bg-red-500/20 hover:bg-red-500/30">
                ğŸšª Ø®Ø±ÙˆØ¬
              </button>
            </div>
          </div>
        </header>
      `;
    }

    function renderNavigation() {
      const tabs = [
        { id: 'dashboard', label: 'Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯', icon: 'ğŸ“Š' },
        { id: 'servers', label: 'Ø³Ø±ÙˆØ±Ù‡Ø§', icon: 'ğŸ–¥ï¸' },
        { id: 'installations', label: 'ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ØµØ¨', icon: 'ğŸ“¦' },
        { id: 'settings', label: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª', icon: 'âš™ï¸' }
      ];
      
      return `
        <nav class="glass-morphism rounded-3xl p-2 mb-8">
          <div class="flex gap-2">
            ${tabs.map(tab => `
              <button onclick="switchView('${tab.id}')" 
                      class="btn-primary flex-1 py-4 rounded-2xl font-bold text-white transition"
                      style="background: ${currentView === tab.id ? 'linear-gradient(135deg, #8b5cf6, #6366f1)' : 'transparent'};">
                ${tab.icon} ${tab.label}
              </button>
            `).join('')}
          </div>
        </nav>
      `;
    }

    function renderContent() {
      switch(currentView) {
        case 'dashboard': return renderDashboard();
        case 'servers': return renderServers();
        case 'installations': return renderInstallations();
        case 'settings': return renderSettings();
        default: return '';
      }
    }

    function renderDashboard() {
      return `
        <div class="space-y-8">
          <!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
          <div class="grid md:grid-cols-4 gap-6">
            <div class="glass-morphism rounded-2xl p-6">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
                  <span class="text-3xl">ğŸ–¥ï¸</span>
                </div>
                <div>
                  <p class="text-white/70 text-sm font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ø³Ø±ÙˆØ±Ù‡Ø§</p>
                  <p class="text-4xl font-black text-white">${stats.totalServers}</p>
                </div>
              </div>
            </div>
            
            <div class="glass-morphism rounded-2xl p-6">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #10b981, #059669);">
                  <span class="text-3xl">âœ“</span>
                </div>
                <div>
                  <p class="text-white/70 text-sm font-semibold">Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</p>
                  <p class="text-4xl font-black text-white">${stats.onlineServers}</p>
                </div>
              </div>
            </div>
            
            <div class="glass-morphism rounded-2xl p-6">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                  <span class="text-3xl">ğŸ“¦</span>
                </div>
                <div>
                  <p class="text-white/70 text-sm font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ù†ØµØ¨â€ŒÙ‡Ø§</p>
                  <p class="text-4xl font-black text-white">${stats.totalInstalls}</p>
                </div>
              </div>
            </div>
            
            <div class="glass-morphism rounded-2xl p-6">
              <div class="flex items-center gap-4">
                <div class="w-14 h-14 rounded-2xl flex items-center justify-center" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                  <span class="text-3xl">ğŸ“ˆ</span>
                </div>
                <div>
                  <p class="text-white/70 text-sm font-semibold">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</p>
                  <p class="text-4xl font-black text-white">${stats.successRate}%</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Ø¢Ø®Ø±ÛŒÙ† Ù†ØµØ¨â€ŒÙ‡Ø§ -->
          <div class="glass-morphism rounded-2xl p-8">
            <h3 class="text-2xl font-bold text-white mb-6">ğŸ“¦ Ø¢Ø®Ø±ÛŒÙ† Ù†ØµØ¨â€ŒÙ‡Ø§</h3>
            
            ${installations.length === 0 ? `
              <div class="text-center py-12">
                <div class="text-6xl mb-4 opacity-50">ğŸ“­</div>
                <p class="text-xl text-white/70">Ù‡Ù†ÙˆØ² Ù†ØµØ¨ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡</p>
              </div>
            ` : `
              <div class="space-y-4">
                ${installations.slice(0, 5).map(install => `
                  <div class="glass-morphism p-4 rounded-xl flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center ${install.status === 'completed' ? 'bg-green-500/20' : 'bg-red-500/20'}">
                      <span class="text-2xl">${install.status === 'completed' ? 'âœ“' : 'âœ—'}</span>
                    </div>
                    <div class="flex-1">
                      <p class="font-bold text-white">${install.template_name}</p>
                      <p class="text-sm text-white/60">${install.server_name} (${install.ip})</p>
                    </div>
                    <div class="text-left">
                      <p class="text-sm font-semibold text-white">${new Date(install.started_at).toLocaleDateString('fa-IR')}</p>
                      <p class="text-xs text-white/60">${new Date(install.started_at).toLocaleTimeString('fa-IR')}</p>
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderServers() {
      return `
        <div class="glass-morphism rounded-2xl p-8">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-2xl font-bold text-white">ğŸ–¥ï¸ Ù„ÛŒØ³Øª Ø³Ø±ÙˆØ±Ù‡Ø§</h3>
            <button onclick="openModal('addServerModal')" 
                    class="btn-primary px-6 py-3 rounded-2xl font-bold text-white"
                    style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
              â• Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÙˆØ±
            </button>
          </div>
          
          ${servers.length === 0 ? `
            <div class="text-center py-12">
              <div class="text-6xl mb-4 opacity-50">ğŸ–¥ï¸</div>
              <p class="text-xl text-white/70 mb-6">Ù‡Ù†ÙˆØ² Ø³Ø±ÙˆØ±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡</p>
              <button onclick="openModal('addServerModal')" 
                      class="btn-primary px-8 py-4 rounded-2xl font-bold text-white"
                      style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
                â• Ø§ÙˆÙ„ÛŒÙ† Ø³Ø±ÙˆØ± Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
              </button>
            </div>
          ` : `
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              ${servers.map(server => `
                <div class="glass-morphism p-6 rounded-2xl">
                  <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                      <div class="w-3 h-3 rounded-full ${server.status === 'online' ? 'status-online' : 'status-offline'}"></div>
                      <h4 class="text-xl font-bold text-white">${server.name || 'Server'}</h4>
                    </div>
                    <button onclick="deleteServer(${server.id})" 
                            class="w-8 h-8 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 text-sm">
                      âœ•
                    </button>
                  </div>
                  
                  <div class="space-y-2 text-sm text-white/80">
                    <p>ğŸŒ <strong>IP:</strong> ${server.ip}</p>
                    <p>ğŸ‘¤ <strong>User:</strong> ${server.username}</p>
                    <p>ğŸ” <strong>Auth:</strong> ${server.auth_method === 'password' ? 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±' : 'Ú©Ù„ÛŒØ¯ SSH'}</p>
                    <p>ğŸ“… <strong>Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯Ù‡:</strong> ${new Date(server.created_at).toLocaleDateString('fa-IR')}</p>
                  </div>
                  
                  <div class="mt-4 pt-4 border-t border-white/10">
                    <button class="w-full py-2 rounded-xl bg-white/10 text-white hover:bg-white/20 font-semibold text-sm">
                      ğŸ”Œ ØªØ³Øª Ø§ØªØµØ§Ù„
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
        </div>
      `;
    }

    function renderInstallations() {
      return `
        <div class="glass-morphism rounded-2xl p-8">
          <h3 class="text-2xl font-bold text-white mb-6">ğŸ“¦ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†ØµØ¨â€ŒÙ‡Ø§</h3>
          
          ${installations.length === 0 ? `
            <div class="text-center py-12">
              <div class="text-6xl mb-4 opacity-50">ğŸ“­</div>
              <p class="text-xl text-white/70">Ù‡Ù†ÙˆØ² Ù†ØµØ¨ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡</p>
            </div>
          ` : `
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead>
                  <tr class="border-b border-white/10">
                    <th class="text-right py-4 px-4 text-white font-bold">ÙˆØ¶Ø¹ÛŒØª</th>
                    <th class="text-right py-4 px-4 text-white font-bold">Template</th>
                    <th class="text-right py-4 px-4 text-white font-bold">Ø³Ø±ÙˆØ±</th>
                    <th class="text-right py-4 px-4 text-white font-bold">ØªØ§Ø±ÛŒØ®</th>
                    <th class="text-right py-4 px-4 text-white font-bold">Ù¾ÛŒØ´Ø±ÙØª</th>
                  </tr>
                </thead>
                <tbody>
                  ${installations.map(install => `
                    <tr class="border-b border-white/5 hover:bg-white/5">
                      <td class="py-4 px-4">
                        <span class="px-3 py-1 rounded-lg text-xs font-bold ${install.status === 'completed' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                          ${install.status === 'completed' ? 'âœ“ Ù…ÙˆÙÙ‚' : 'âœ— Ù†Ø§Ù…ÙˆÙÙ‚'}
                        </span>
                      </td>
                      <td class="py-4 px-4 text-white font-semibold">${install.template_name}</td>
                      <td class="py-4 px-4 text-white/80">${install.server_name}</td>
                      <td class="py-4 px-4 text-white/60 text-sm">${new Date(install.started_at).toLocaleString('fa-IR')}</td>
                      <td class="py-4 px-4">
                        <div class="flex items-center gap-3">
                          <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-purple-500 to-blue-500 rounded-full" style="width: ${install.progress}%;"></div>
                          </div>
                          <span class="text-white font-bold text-sm">${install.progress}%</span>
                        </div>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `}
        </div>
      `;
    }

    function renderSettings() {
      return `
        <div class="glass-morphism rounded-2xl p-8">
          <h3 class="text-2xl font-bold text-white mb-6">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h3>
          
          <form id="changePasswordForm" class="space-y-6 max-w-2xl">
            <div>
              <h4 class="text-xl font-bold text-white mb-4">ğŸ” ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</h4>
            </div>
            
            <div>
              <label class="block font-semibold mb-3 text-white">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ *</label>
              <input type="password" id="oldPassword" required
                     class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" 
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <div>
              <label class="block font-semibold mb-3 text-white">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ *</label>
              <input type="password" id="newPassword" required
                     class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" 
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <div>
              <label class="block font-semibold mb-3 text-white">ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ *</label>
              <input type="password" id="confirmPassword" required
                     class="glass-morphism w-full px-6 py-4 rounded-2xl font-medium text-white focus:outline-none focus:ring-2 focus:ring-purple-500" 
                     placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            
            <button type="submit" 
                    class="btn-primary px-8 py-4 rounded-2xl font-bold text-white"
                    style="background: linear-gradient(135deg, #8b5cf6, #6366f1);">
              ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
            </button>
          </form>
          
          <div class="mt-12 pt-8 border-t border-white/10">
            <h4 class="text-xl font-bold text-white mb-4">â„¹ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ…</h4>
            <div class="space-y-3 text-white/80">
              <p>ğŸ“Œ <strong>Ù†Ø³Ø®Ù‡:</strong> WarOps Panel v1.0.0</p>
              <p>ğŸŒ <strong>API URL:</strong> ${API_URL}</p>
              <p>ğŸ‘¤ <strong>Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ:</strong> ${currentUser}</p>
            </div>
          </div>
        </div>
      `;
    }

    function attachEventListeners() {
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
      }
      
      const addServerForm = document.getElementById('addServerForm');
      if (addServerForm) {
        addServerForm.addEventListener('submit', handleAddServer);
      }
      
      const changePasswordForm = document.getElementById('changePasswordForm');
      if (changePasswordForm) {
        changePasswordForm.addEventListener('submit', handleChangePassword);
      }
    }

    async function handleAddServer(e) {
      e.preventDefault();
      
      const serverData = {
        name: document.getElementById('serverName').value,
        ip: document.getElementById('serverIpAdd').value,
        username: document.getElementById('serverUsernameAdd').value,
        authMethod: document.getElementById('serverAuthMethod').value,
        password: document.getElementById('serverPasswordAdd').value,
        sshKey: document.getElementById('serverSshKeyAdd').value
      };
      
      try {
        const response = await fetch(`${API_URL}/servers`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(serverData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showNotification('âœ“ Ø³Ø±ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯', 'success');
          closeModal('addServerModal');
          await loadDashboard();
          render();
        } else {
          showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÙˆØ±', 'error');
        }
      } catch (error) {
        showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    async function deleteServer(id) {
      if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø³Ø±ÙˆØ± Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
      
      try {
        const response = await fetch(`${API_URL}/servers/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${authToken}` }
        });
        
        if (response.ok) {
          showNotification('âœ“ Ø³Ø±ÙˆØ± Ø­Ø°Ù Ø´Ø¯', 'success');
          await loadDashboard();
          render();
        } else {
          showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø³Ø±ÙˆØ±', 'error');
        }
      } catch (error) {
        showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
      }
    }

    async function handleChangePassword(e) {
      e.preventDefault();
      
      const oldPassword = document.getElementById('oldPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (newPassword !== confirmPassword) {
        showNotification('âœ— Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_URL}/auth/change-password`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify({ oldPassword, newPassword })
        });
        
        if (response.ok) {
          showNotification('âœ“ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯', 'success');
          document.getElementById('changePasswordForm').reset();
        } else {
          showNotification('âœ— Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙØ¹Ù„ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
        }
      } catch (error) {
        showNotification('âœ— Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±', 'error');
      }
    }

    function switchView(view) {
      currentView = view;
      render();
    }

    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    function toggleAuthFields() {
      const authMethod = document.getElementById('serverAuthMethod').value;
      document.getElementById('passwordField').style.display = authMethod === 'password' ? 'block' : 'none';
      document.getElementById('sshKeyField').style.display = authMethod === 'key' ? 'block' : 'none';
    }

    function logout() {
      localStorage.removeItem('warops_token');
      localStorage.removeItem('warops_user');
      authToken = null;
      currentUser = null;
      showLoginModal();
      render();
    }

    function showNotification(message, type = 'success') {
      const container = document.getElementById('notification');
      const colors = {
        success: 'linear-gradient(135deg, #10b981, #059669)',
        error: 'linear-gradient(135deg, #ef4444, #dc2626)',
        info: 'linear-gradient(135deg, #3b82f6, #2563eb)'
      };
      
      container.innerHTML = `
        <div style="background: ${colors[type]}; color: white; padding: 18px 28px; border-radius: 20px; font-weight: 700; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease;">
          ${message}
        </div>
      `;
      
      setTimeout(() => container.innerHTML = '', 3500);
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b74446681b626ad',t:'MTc2NzI5NDEwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
